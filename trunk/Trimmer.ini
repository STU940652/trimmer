#Trimmer Ini File
#
# This can be in the AppsData directory, or the ProgramFiles directory.  Anything in AppsData overrides ProgramFiles
#
# The FilePaths Section is normally only in AppsData
#[FilePaths]
#FileCopy = False
#SourcePath = D:\PRIVATE\AVCHD\BDMV\STREAM
#DestPath = C:\Documents and Settings\AndynDeanna\My Documents\Sandbox
#AutoStart = True

[Upload]
MP3BasePath = sermons\%%Y

[Segment1]
Name = Site Video: No Prayer (With Upload)
EncodeString = ffmpeg -report -nostdin -i "$InFile$"
 -vf "fade=in:st=$FadeInStart$:d=$FadeLength$,fade=out:st=$FadeOutStart$:d=$FadeLength$,format=pix_fmts=yuv420p"
 -vcodec libx264 -profile:v baseline -x264opts keyint=123:min-keyint=25:crf=19 -vsync cfr
 -af "dynaudnorm=b=1:m=100.0,afade=in:st=$FadeInStart$:d=$FadeLength$,afade=out:st=$FadeOutStart$:d=$FadeLength$"
 -acodec aac -ac 2 -ab 320k -profile:a aac_low
 -ss $FadeInStart$ -t $OutputLength$ "$OutFileName$.mp4"
DefaultOutFileName = $DateSunday$_without_prayer
Completion = {"Site-MP4": "$OutFileName$.mp4"}

[Segment2]
Name = Public Video: With Prayer (With Upload)
EncodeString = ffmpeg -report -nostdin  -i "$InFile$"
 -vf "fade=in:st=$FadeInStart$:d=$FadeLength$,fade=out:st=$FadeOutStart$:d=$FadeLength$,format=pix_fmts=yuv420p"
 -vcodec libx264 -profile:v high -x264opts keyint=123:min-keyint=25:crf=21 -vsync cfr
 -af "dynaudnorm=b=1:m=100.0,afade=in:st=$FadeInStart$:d=$FadeLength$,afade=out:st=$FadeOutStart$:d=$FadeLength$"
 -acodec aac -ac 2 -ar 48000 -ab 320k -profile:a aac_low
 -metadata title="$Title$"
 -metadata album="$Series$"
 -metadata artist="$Speaker$"
 -metadata comment="$Date$ $Comment$"
 -ss $FadeInStart$ -t $OutputLengthNoHT$ "$OutFileName$-$SpeakerLast$.mp4"
 -ss $FadeInStart$ -t $OutputLengthNoHT$ -map_channel 0.1.0 "$OutFileName$-$SpeakerLast$.wav" 
 -af "dynaudnorm=b=1:m=100.0,aresample=22050,aformat=channel_layouts=mono" 
 -metadata title="$Title$"
 -metadata album="$Series$"
 -metadata artist="$Speaker$"
 -metadata date="$Date$"
 -metadata comment="$Comment$"
 -id3v2_version 3
 -write_id3v1 1
 -acodec libmp3lame -ab 32k -ss $FadeInStart$ -t $OutputLengthNoHT$ "$OutFileName$-$SpeakerLast$.mp3"
DefaultOutFileName = $DateSunday$sermon
Completion = {"MP3":"$OutFileName$-$SpeakerLast$.mp3", "MP4": "$OutFileName$-$SpeakerLast$.mp4"}

[Segment3]
Name = Custom
AdditionalInputs = &Upload_To_Vimeo,Vimeo_Title,&Vimeo_Private,@Vimeo_Thumbnail
EncodeString = ffmpeg -report -nostdin -i "$InFile$"
 -vf "fade=in:st=$FadeInStart$:d=$FadeLength$,fade=out:st=$FadeOutStart$:d=$FadeLength$,format=pix_fmts=yuv420p"
 -vcodec libx264 -profile:v baseline -x264opts keyint=123:min-keyint=25:crf=19 -vsync cfr
 -af "dynaudnorm=b=1:m=100.0,afade=in:st=$FadeInStart$:d=$FadeLength$,afade=out:st=$FadeOutStart$:d=$FadeLength$"
 -acodec aac -ac 2 -ab 320k -profile:a aac_low
 -ss $OutputStart$ -t $OutputLength$ "$OutFileName$_$Vimeo_Title_For_Filename$.mp4"
DefaultOutFileName = $DateSunday$_custom
Completion = {"Custom-MP4": "$OutFileName$_$Vimeo_Title_For_Filename$.mp4", "Title": "$Vimeo_Title$", "Vimeo_Private": "$&Vimeo_Private$", "Mp4Enable": "$&Upload_To_Vimeo$", "Vimeo_Thumbnail": "$@Vimeo_Thumbnail$"}

[Segment4]
Name = Site Video: With MP4 Preroll, No Prayer (With Upload)
AdditionalInputs = @Pre_Roll_MP4,@Vimeo_Thumbnail
EncodeString = ffmpeg -report -nostdin 
 -i "$@Pre_Roll_MP4$"
 -ss $ClipStart$ -t $ClipLength$  -i "$InFile$"
 -filter_complex "color=c=black:s=hd1080:r=ntsc:d=0.1 [vblackin];aevalsrc=0:d=0.1 [ablackin];[0:v:0] scale=s=hd1080,setsar=0 [vbumpscale]; [1:v:0] fade=in:st=0:d=0.5,fade=out:st=$ClipFade$:d=0.5,format=pix_fmts=yuv420p,scale=s=hd1080 [vtrim];[1:a:0] dynaudnorm=b=1:m=100.0,afade=in:st=0:d=0.5,afade=out:st=$ClipFade$:d=0.5 [atrim];color=c=black:s=hd1080:r=ntsc:d=10.0 [vblackout];aevalsrc=0:d=10 [ablackout];[vblackin] [ablackin] [vbumpscale] [0:a:0] [vtrim] [atrim] [vblackout] [ablackout] concat=n=4:v=1:a=1 [v] [a]" 
 -map "[v]" -map "[a]" 
 -vcodec libx264 -profile:v baseline -x264opts keyint=123:min-keyint=25:crf=19 -vsync cfr
 -acodec aac -ac 2 -ab 320k -profile:a aac_low
 "$OutFileName$.mp4"
DefaultOutFileName = $DateSunday$_without_prayer
Completion = {"Site-MP4": "$OutFileName$.mp4", "Vimeo_Thumbnail": "$@Vimeo_Thumbnail$"}

[Segment5]
Name = Public Video: With MP4 Preroll, No Prayer (With Upload)
AdditionalInputs = @Pre_Roll_MP4,@Vimeo_Thumbnail 
EncodeString = ffmpeg -report -nostdin 
 -i "$@Pre_Roll_MP4$"
 -ss $ClipStart$ -t $ClipLength$ -i "$InFile$"
 -filter_complex "[0:v:0] scale=s=hd1080,setsar=0 [vbumpscale]; [1:v:0] fade=in:st=0:d=0.5,fade=out:st=$ClipFade$:d=0.5,format=pix_fmts=yuv420p,scale=s=hd1080 [vtrim];[1:a:0] dynaudnorm=b=1:m=100.0,afade=in:st=0:d=0.5,afade=out:st=$ClipFade$:d=0.5 [atrim];[vbumpscale] [0:a:0] [vtrim] [atrim] concat=n=2:v=1:a=1 [v] [a]; [a] asplit=2 [amp4] [amp3]" 
 -map "[v]" -map "[amp4]" 
 -acodec aac -ac 2 -ar 48000 -ab 320k -profile:a aac_low
 -metadata title="$Title$"
 -metadata album="$Series$"
 -metadata artist="$Speaker$"
 -metadata comment="$Date$ $Comment$"
 "$OutFileName$-$SpeakerLast$.mp4"
 -map "[amp3]"
 -metadata title="$Title$"
 -metadata album="$Series$"
 -metadata artist="$Speaker$"
 -metadata date="$Date$"
 -metadata comment="$Comment$"
 -id3v2_version 3
 -write_id3v1 1
 -acodec libmp3lame -ab 64k "$OutFileName$-$SpeakerLast$.mp3"
DefaultOutFileName = $DateSunday$sermon
Completion = {"MP3":"$OutFileName$-$SpeakerLast$.mp3", "MP4": "$OutFileName$-$SpeakerLast$.mp4", "Vimeo_Thumbnail": "$@Vimeo_Thumbnail$"}

# Attempt at JPEG preroll
#
#[Segment4]
#Name = Public Video: With JPEG Preroll, No Prayer (With Upload)
#AdditionalInputs = @Pre_Roll_Logo 
#EncodeString = ffmpeg -report -nostdin 
# -loop 1 -t 4 -i "$@Pre_Roll_Logo$"
# -ss $ClipStart$ -t $ClipLength$ -i "$InFile$"
# -filter_complex "[0:v:0] scale=s=hd1080,setsar=0,fade=in:st=0:d=0.5,fade=out:st=3.5:d=0.5 [vbumpscale]; aevalsrc=0:d=4 [abump]; [1:v:0] fade=in:st=0:d=0.5,fade=out:st=$ClipFade$:d=0.5,format=pix_fmts=yuv420p,scale=s=hd1080 [vtrim];[1:a:0] afade=out:st=$ClipFade$:d=0.5 [atrim];[vbumpscale] [abump] [vtrim] [atrim] concat=n=2:v=1:a=1 [v] [a]; [a] dynaudnorm=b=1:m=100.0,afade=in:st=0:d=0.5,asplit=2 [amp4] [amp3]" 
# -map "[v]" -map "[amp4]" 
# -acodec aac -ac 2 -ar 48000 -ab 320k -profile:a aac_low
# -metadata title="$Title$"
# -metadata album="$Series$"
# -metadata artist="$Speaker$"
# -metadata comment="$Date$ $Comment$"
# "$OutFileName$-$SpeakerLast$.mp4"
# -map_channel 1.1.0 "$OutFileName$-$SpeakerLast$.wav" 
# -map "[amp3]"
# -metadata title="$Title$"
# -metadata album="$Series$"
# -metadata artist="$Speaker$"
# -metadata date="$Date$"
# -metadata comment="$Comment$"
# -id3v2_version 3
# -write_id3v1 1
# -acodec libmp3lame -ab 32k -ss 4 "$OutFileName$-$SpeakerLast$.mp3"
#DefaultOutFileName = $DateSunday$sermon
#Completion = {"MP3":"$OutFileName$-$SpeakerLast$.mp3", "MP4": "$OutFileName$-$SpeakerLast$.mp4", "Vimeo_Picture": "$@Pre_Roll_Logo$"}
